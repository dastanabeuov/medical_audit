# Medical Audit System

> AI-powered ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ğ´Ğ»Ñ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ° Ğ¼ĞµĞ´Ğ¸Ñ†Ğ¸Ğ½ÑĞºĞ¸Ñ… ĞºĞ¾Ğ½ÑÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ»Ğ¸ÑÑ‚Ğ¾Ğ² (ĞšĞ›) Ğ½Ğ° ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ ĞœĞšĞ‘-10/11 Ğ¸ Ğ¿Ñ€Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ»Ğ°Ğ¼ ĞœĞ— Ğ Ğš

**Ğ’ĞµÑ€ÑĞ¸Ñ**: 1.0.0
**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ**: Ğ’ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞµ

---

## ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

Medical Audit System â€” Rails 8 Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‰ĞµĞµ Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ RAG (Retrieval-Augmented Generation) Ğ´Ğ»Ñ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ° Ğ¼ĞµĞ´Ğ¸Ñ†Ğ¸Ğ½ÑĞºĞ¸Ñ… ĞºĞ¾Ğ½ÑÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ»Ğ¸ÑÑ‚Ğ¾Ğ². Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ½Ñ‹Ğµ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ñ‹, ÑĞ²ĞµÑ€ÑĞµÑ‚ Ğ¸Ñ… Ñ Ğ±Ğ°Ğ·Ğ¾Ğ¹ Ğ·Ğ½Ğ°Ğ½Ğ¸Ğ¹ (ĞœĞšĞ‘-10/11 + Ğ¿Ñ€Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ»Ñ‹ ĞœĞ— Ğ Ğš) Ğ¸ Ğ²Ñ‹ÑÑ‚Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ¾Ñ†ĞµĞ½ĞºÑƒ ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ñ Ñ Ñ†Ğ²ĞµÑ‚Ğ¾Ğ²Ğ¾Ğ¹ ĞºĞ»Ğ°ÑÑĞ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸ĞµĞ¹.

**ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸:**
- ĞŸĞ°ĞºĞµÑ‚Ğ½Ğ°Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¸ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° 100+ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² (PDF, DOCX, TXT)
- AI-Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ğ²ĞµĞºÑ‚Ğ¾Ñ€Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ¸ÑĞºĞ° (pgvector) Ğ¸ Gemini 2.0 Flash
- ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ ĞºĞ»Ğ°ÑÑĞ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ: ğŸ”´ Red (<50), ğŸŸ¡ Yellow (50-80), ğŸŸ¢ Green (80+)
- Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ ÑĞ°Ğ½Ğ¸Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ)
- ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ°Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ñ‡ĞµÑ€ĞµĞ· Sidekiq

---

## 1. ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

### 1.1 ĞĞ±Ñ‰Ğ°Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend      â”‚  VueJS + Tailwind CSS + Stimulus + Turbo (Hotwire)
â”‚  (View Layer)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Controllers   â”‚  Namespaced: cabinet/auditors, cabinet/main_doctors, cabinet/doctors
â”‚   (Rails MVC)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Services     â”‚  AdvisorySheetVerificationService, GeminiService, etc.
â”‚  (Business      â”‚  RAG Pipeline: Sanitize â†’ Embed â†’ Retrieve â†’ Verify â†’ Save
â”‚   Logic)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Models      â”‚  ActiveRecord Ñ pgvector (Neighbor gem)
â”‚   (Data Layer)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PostgreSQL    â”‚  17 + pgvector extension
â”‚   + Redis       â”‚  Vector embeddings (768d) + Sidekiq queue
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  External API   â”‚  Google Gemini API (embeddings)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 RAG Pipeline (5 ÑÑ‚Ğ°Ğ¿Ğ¾Ğ²)

```
1. UPLOAD
   â”œâ”€ FileParserService (PDF/DOCX/TXT â†’ text)
   â””â”€ AdvisorySheetUploadService (ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ NotVerifiedAdvisorySheet)

2. SANITIZE
   â””â”€ PersonalDataSanitizerService (ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ¤Ğ˜Ğ, Ğ˜Ğ˜Ğ, Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½Ğ¾Ğ²)

3. EMBED
   â””â”€ GeminiService.generate_embedding (text â†’ vector 768d)

4. RETRIEVE (Hybrid Search)
   â”œâ”€ Vector similarity: Protocol.search_similar (top 5)
   â””â”€ Text + Vector: Mkb.search_similar (top 10)

5. VERIFY & SAVE
   â”œâ”€ GeminiService.verify_advisory_sheet (AI Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·)
   â””â”€ VerifiedAdvisorySheet.create (ÑÑ‚Ğ°Ñ‚ÑƒÑ: red/yellow/green)
```

### 1.3 Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ñ„Ñ€Ğ¾Ğ½Ñ‚ĞµĞ½Ğ´Ğ°

**Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸:** Rails Views (ERB/SLIM) VueJS + Tailwind CSS 4 + Hotwire (Turbo + Stimulus)

**ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹:**
- `/` - Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ (home#index)
- `/cabinet/auditors/login` - Ğ’Ñ…Ğ¾Ğ´ Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ¾Ñ€Ğ°
- `/cabinet/auditors/dashboard` - Ğ”Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´ Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ¾Ñ€Ğ°
- `/cabinet/auditors/advisory_sheets` - Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº ĞšĞ›
- `/cabinet/auditors/advisory_sheets/upload` - Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
- `/cabinet/main_doctors/dashboard` - Ğ”Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´ Ğ³Ğ»Ğ°Ğ²Ğ²Ñ€Ğ°Ñ‡Ğ°
- `/cabinet/doctors/dashboard` - Ğ”Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´ Ğ²Ñ€Ğ°Ñ‡Ğ°

**Ğ’Ğ·Ğ°Ğ¸Ğ¼Ğ¾Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ Ñ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğ¼Ğ¸ ÑĞµÑ€Ğ²Ğ¸ÑĞ°Ğ¼Ğ¸:**
- **Google Gemini API**:
  - Ğ­Ğ½Ğ´Ğ¿Ğ¾Ğ¸Ğ½Ñ‚: `generativelanguage.googleapis.com`
  - ĞœĞµÑ‚Ğ¾Ğ´Ñ‹: `embed` (embeddings), `chat` (verification)
  - ĞÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ: API Key Ñ‡ĞµÑ€ĞµĞ· RubyLLM gem

### 1.4 Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ±ÑĞºĞµĞ½Ğ´Ğ°

```
app/
â”œâ”€â”€ controllers/
â”‚   â”œâ”€â”€ cabinet/
â”‚   â”‚   â”œâ”€â”€ auditors/          # ĞšĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€Ñ‹ Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ¾Ñ€Ğ°
â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard_controller.rb
â”‚   â”‚   â”‚   â”œâ”€â”€ advisory_sheets_controller.rb
â”‚   â”‚   â”‚   â””â”€â”€ sessions_controller.rb
â”‚   â”‚   â”œâ”€â”€ main_doctors/      # ĞšĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€Ñ‹ Ğ³Ğ»Ğ°Ğ²Ğ²Ñ€Ğ°Ñ‡Ğ°
â”‚   â”‚   â””â”€â”€ doctors/           # ĞšĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€Ñ‹ Ğ²Ñ€Ğ°Ñ‡Ğ°
â”‚   â””â”€â”€ home_controller.rb
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ auditor.rb             # Devise user
â”‚   â”œâ”€â”€ main_doctor.rb         # Devise user
â”‚   â”œâ”€â”€ doctor.rb              # Devise user
â”‚   â”œâ”€â”€ not_verified_advisory_sheet.rb
â”‚   â”œâ”€â”€ verified_advisory_sheet.rb
â”‚   â”œâ”€â”€ mkb.rb                 # ICD codes Ñ embeddings
â”‚   â””â”€â”€ protocol.rb            # ĞŸÑ€Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ»Ñ‹ Ñ embeddings
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ advisory_sheet_upload_service.rb
â”‚   â”œâ”€â”€ advisory_sheet_verification_service.rb  # â­ Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ ÑĞµÑ€Ğ²Ğ¸Ñ
â”‚   â”œâ”€â”€ gemini_service.rb                       # â­ AI Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ
â”‚   â”œâ”€â”€ personal_data_sanitizer_service.rb
â”‚   â”œâ”€â”€ file_parser_service.rb
â”‚   â”œâ”€â”€ mkb_import_service.rb
â”‚   â””â”€â”€ protocol_import_service.rb
â”œâ”€â”€ jobs/
â”‚   â”œâ”€â”€ verify_advisory_sheet_job.rb
â”‚   â”œâ”€â”€ verify_all_advisory_sheets_job.rb
â”‚   â””â”€â”€ import_knowledge_base_job.rb
â””â”€â”€ views/
    â”œâ”€â”€ cabinet/
    â”‚   â”œâ”€â”€ auditors/
    â”‚   â”œâ”€â”€ main_doctors/
    â”‚   â””â”€â”€ doctors/
    â””â”€â”€ home/
```

---

## 2. Readme Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ°

### 2.1 Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğµ Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

| ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ | Ğ’ĞµÑ€ÑĞ¸Ñ | ĞĞ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ |
|-----------|--------|-------------|
| Ruby | 3.4.3 | âœ… |
| Rails | 8.0.4 | âœ… |
| PostgreSQL | 17+ | âœ… (Ñ Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸ĞµĞ¼ pgvector) |
| Redis | 5.4+ | âœ… (Ğ´Ğ»Ñ Sidekiq) |
| Node.js | 18+ | âœ… (Ğ´Ğ»Ñ Tailwind CSS) |
| Kamal | 2+ | âšª (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾, Ğ´Ğ»Ñ Ğ´ĞµĞ¿Ğ»Ğ¾Ñ) |
| Docker | 20+ | âšª (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾, Ğ´Ğ»Ñ Ğ´ĞµĞ¿Ğ»Ğ¾Ñ) |

### 2.2 Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ°

```bash
# 1. ĞšĞ»Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¹
git clone <repository-url>
cd medical_audit

# 2. Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸
bundle install

# 3. ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ
cp .env.example .env
# Ğ—Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ GEMINI_API_KEY Ğ² .env

# 4. ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Ğ±Ğ°Ğ·Ñƒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
# Ğ£Ğ±ĞµĞ´Ğ¸Ñ‚ÑŒÑÑ, Ñ‡Ñ‚Ğ¾ PostgreSQL 17 ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ Ğ¸ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½
# Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ğµ pgvector:
# CREATE EXTENSION IF NOT EXISTS vector;

rails db:create
rails db:migrate

# 5. (ĞĞ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾) Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ seed Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
rails db:seed
```

### 2.3 Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ² Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸

```bash
# Ğ—Ğ°Ğ¿ÑƒÑĞº ÑĞµÑ€Ğ²ĞµÑ€Ğ° + Tailwind CSS watcher
bin/dev

# ĞĞ»ÑŒÑ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ½Ğ¾ (Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑÑ‹):
# Terminal 1: Rails server
rails server -p 3000

# Terminal 2: Tailwind CSS watcher
rails tailwindcss:watch

# Terminal 3: Sidekiq (Ğ´Ğ»Ñ Ñ„Ğ¾Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ·Ğ°Ğ´Ğ°Ñ‡)
bundle exec sidekiq
```

**Ğ”Ğ¾ÑÑ‚ÑƒĞ¿:**
- ĞŸÑ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ: http://localhost:3000
- Sidekiq UI: http://localhost:3000/sidekiq (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ development)

### 2.4 Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

```bash
# ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğ¾Ğ¹ Ğ‘Ğ”
RAILS_ENV=test rails db:setup

# Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ²ÑĞµÑ… Ñ‚ĞµÑÑ‚Ğ¾Ğ²
bundle exec rspec

# Ğ—Ğ°Ğ¿ÑƒÑĞº ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ³Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ°
bundle exec rspec spec/models/verified_advisory_sheet_spec.rb

# Ğ¡ Ğ¿Ğ¾ĞºÑ€Ñ‹Ñ‚Ğ¸ĞµĞ¼ ĞºĞ¾Ğ´Ğ°
COVERAGE=true bundle exec rspec

# Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğµ Ñ‚ĞµÑÑ‚Ñ‹ (Ñ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ¾Ğ¼)
bundle exec rspec spec/system
```

### 2.5 ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ° ĞºĞ¾Ğ´Ğ°

```bash
# Ğ›Ğ¸Ğ½Ñ‚ĞµÑ€ (RuboCop Ñ Rails Omakase ÑÑ‚Ğ¸Ğ»ĞµĞ¼)
bundle exec rubocop

# ĞĞ²Ñ‚Ğ¾Ñ„Ğ¸ĞºÑ
bundle exec rubocop -a

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸
bundle exec brakeman

# N+1 queries detection (Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ² development)
# Bullet Ğ¿Ğ¾ĞºĞ°Ğ¶ĞµÑ‚ Ğ¿Ñ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ñ Ğ² ĞºĞ¾Ğ½ÑĞ¾Ğ»Ğ¸/Ğ»Ğ¾Ğ³Ğ°Ñ…
```

### 2.6 Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ´Ğ°ĞºÑˆĞµĞ½Ğ°

```bash
# Precompile assets
rails assets:precompile RAILS_ENV=production

# Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Docker Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ° (Ğ´Ğ»Ñ Kamal)
docker build -t medical_audit:latest .

# Ğ”ĞµĞ¿Ğ»Ğ¾Ğ¹ Ñ‡ĞµÑ€ĞµĞ· Kamal (ÑĞ¼. Ñ€Ğ°Ğ·Ğ´ĞµĞ» 5)
kamal deploy
```

### 2.7 Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° (ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸)

```
medical_audit/
â”œâ”€â”€ app/                      # ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ´ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ
â”‚   â”œâ”€â”€ controllers/          # MVC Controllers
â”‚   â”œâ”€â”€ models/               # ActiveRecord Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸
â”‚   â”œâ”€â”€ services/             # â­ Ğ‘Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° (RAG pipeline)
â”‚   â”œâ”€â”€ jobs/                 # Sidekiq background jobs
â”‚   â”œâ”€â”€ views/                # ERB ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ñ‹
â”‚   â””â”€â”€ assets/               # CSS/JS (Ñ‡ĞµÑ€ĞµĞ· Propshaft)
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ database.yml          # ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ‘Ğ”
â”‚   â”œâ”€â”€ deploy.yml            # â­ Kamal deployment config
â”‚   â”œâ”€â”€ routes.rb             # ĞœĞ°Ñ€ÑˆÑ€ÑƒÑ‚Ñ‹
â”‚   â””â”€â”€ initializers/
â”‚       â””â”€â”€ ruby_llm.rb       # â­ Gemini API config
â”œâ”€â”€ db/
â”‚   â”œâ”€â”€ migrate/              # ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ‘Ğ”
â”‚   â”œâ”€â”€ schema.rb             # Ğ¡Ñ…ĞµĞ¼Ğ° Ğ‘Ğ”
â”‚   â””â”€â”€ seeds.rb              # Seed Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
â”œâ”€â”€ data_mkb/                 # â­ Ğ˜ÑÑ…Ğ¾Ğ´Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ ĞœĞšĞ‘-10/11
â”œâ”€â”€ data_protocol/            # â­ Ğ˜ÑÑ…Ğ¾Ğ´Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ»Ñ‹ ĞœĞ— Ğ Ğš
â”œâ”€â”€ spec/                     # RSpec Ñ‚ĞµÑÑ‚Ñ‹
â”‚   â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ services/             # â­ ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ñ‚ĞµÑÑ‚Ñ‹ RAG Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¸
â”‚   â”œâ”€â”€ jobs/
â”‚   â””â”€â”€ system/
â”œâ”€â”€ Procfile.dev              # Foreman Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑÑ‹ (bin/dev)
â””â”€â”€ Gemfile                   # Ruby Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸
```

---

## 3. Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### 3.1 ĞĞ±Ğ·Ğ¾Ñ€

**Ğ¡Ğ£Ğ‘Ğ”:** PostgreSQL 17
**Ğ Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ñ:** pgvector (Ğ´Ğ»Ñ Ğ²ĞµĞºÑ‚Ğ¾Ñ€Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ¸ÑĞºĞ°)
**ORM:** ActiveRecord (Rails 8)

**ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹:** 7 Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† + 3 Devise users

### 3.2 Ğ¡Ñ…ĞµĞ¼Ğ° Ğ‘Ğ”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    auditors      â”‚ (Devise)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id               â”‚ PK
â”‚ email            â”‚ unique
â”‚ first_name       â”‚
â”‚ last_name        â”‚
â”‚ position         â”‚
â”‚ encrypted_...    â”‚ (Devise fields)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 1:N
         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                 â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ not_verified_advisory... â”‚  â”‚ verified_advisory_sheets  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id                       â”‚  â”‚ id                        â”‚
â”‚ recording                â”‚  â”‚ recording                 â”‚
â”‚ body                     â”‚  â”‚ body                      â”‚
â”‚ auditor_id               â”‚  â”‚ status (enum: 0/1/2)      â”‚ ğŸ”´ğŸŸ¡ğŸŸ¢
â”‚ original_filename        â”‚  â”‚ verification_result       â”‚
â”‚ created_at               â”‚  â”‚ recommendations           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ auditor_id                â”‚
                              â”‚ verified_at               â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   main_doctors   â”‚ (Devise)â”‚     doctors      â”‚ (Devise)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id               â”‚ PK   â”Œâ”€â”€â”‚ id               â”‚ PK
â”‚ email            â”‚      â”‚  â”‚ email            â”‚
â”‚ first_name       â”‚      â”‚  â”‚ first_name       â”‚
â”‚ last_name        â”‚      â”‚  â”‚ last_name        â”‚
â”‚ department       â”‚      â”‚  â”‚ specialization   â”‚
â”‚ specialization   â”‚ 1:N  â””â”€â”€â”‚ main_doctor_id   â”‚ FK
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       mkbs       â”‚         â”‚    protocols     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id               â”‚ PK      â”‚ id               â”‚ PK
â”‚ code             â”‚ unique  â”‚ title            â”‚
â”‚ title            â”‚         â”‚ code             â”‚
â”‚ description      â”‚         â”‚ content          â”‚
â”‚ embedding        â”‚ ğŸ§® 768d â”‚ embedding        â”‚ ğŸ§® 768d
â”‚ source_file      â”‚         â”‚ source_file      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†‘                            â†‘
     â””â”€â”€â”€â”€â”€â”€â”€ pgvector â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     (cosine similarity search)
```

### 3.3 ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹

#### 3.3.1 Users (Devise, 3 Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸)

| Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° | Ğ Ğ¾Ğ»ÑŒ | ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ |
|---------|------|---------------|
| `auditors` | ĞœĞµĞ´Ğ¸Ñ†Ğ¸Ğ½ÑĞºĞ¸Ğ¹ Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ¾Ñ€ | email, first_name, last_name, position |
| `main_doctors` | Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ Ğ²Ñ€Ğ°Ñ‡ Ğ¾Ñ‚Ğ´ĞµĞ»ĞµĞ½Ğ¸Ñ | email, first_name, last_name, department |
| `doctors` | Ğ’Ñ€Ğ°Ñ‡ | email, first_name, last_name, specialization, main_doctor_id (FK) |

**Ğ’ÑĞµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ Devise:** database_authenticatable, registerable, recoverable, rememberable, validatable, confirmable, lockable, trackable

#### 3.3.2 Advisory Sheets (ĞšĞ¾Ğ½ÑÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ»Ğ¸ÑÑ‚Ñ‹)

**`not_verified_advisory_sheets`** (Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ°Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°)
- `recording` (string, NOT NULL) - Ğ½Ğ¾Ğ¼ĞµÑ€ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸/Ğ˜Ğ˜Ğ
- `body` (text, NOT NULL) - ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°
- `auditor_id` (FK â†’ auditors)
- `original_filename` (string) - Ğ¸Ğ¼Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ°

**`verified_advisory_sheets`** (Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸)
- `recording` (string, NOT NULL)
- `body` (text, NOT NULL)
- `status` (integer, enum) - **0: red, 1: yellow, 2: green**
- `verification_result` (text) - Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ AI Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°
- `recommendations` (text) - Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸
- `auditor_id` (FK â†’ auditors)
- `verified_at` (datetime) - Ğ²Ñ€ĞµĞ¼Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸

**Workflow:** NotVerifiedAdvisorySheet â†’ (verification job) â†’ VerifiedAdvisorySheet, Ğ·Ğ°Ñ‚ĞµĞ¼ NOT_VERIFIED ÑƒĞ´Ğ°Ğ»ÑĞµÑ‚ÑÑ.

#### 3.3.3 Knowledge Base (Ğ‘Ğ°Ğ·Ğ° Ğ·Ğ½Ğ°Ğ½Ğ¸Ğ¹)

**`mkbs`** (ĞœĞšĞ‘-10/11 ĞºĞ¾Ğ´Ñ‹)
- `code` (string, unique, NOT NULL) - ĞºĞ¾Ğ´ ĞœĞšĞ‘ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, "J18.0")
- `title` (string, NOT NULL) - Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ±Ğ¾Ğ»ĞµĞ²Ğ°Ğ½Ğ¸Ñ
- `description` (text) - Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ
- `embedding` (vector[768]) - **Ğ²ĞµĞºÑ‚Ğ¾Ñ€Ğ½Ğ¾Ğµ Ğ¿Ñ€ĞµĞ´ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ¸ÑĞºĞ°**
- `source_file` (string) - Ñ„Ğ°Ğ¹Ğ»-Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ¸Ğ· data_mkb/

**`protocols`** (ĞŸÑ€Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ»Ñ‹ ĞœĞ— Ğ Ğš)
- `title` (string, NOT NULL) - Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ»Ğ°
- `code` (string) - ĞºĞ¾Ğ´ Ğ¿Ñ€Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ»Ğ°
- `content` (text, NOT NULL) - ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ Ğ¿Ñ€Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ»Ğ°
- `embedding` (vector[768]) - **Ğ²ĞµĞºÑ‚Ğ¾Ñ€Ğ½Ğ¾Ğµ Ğ¿Ñ€ĞµĞ´ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ¸ÑĞºĞ°**
- `source_file` (string) - Ñ„Ğ°Ğ¹Ğ»-Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ¸Ğ· data_protocol/

**Vector Search:** Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ pgvector extension Ñ cosine distance Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¾Ğ¹.

### 3.5 Ğ˜Ğ½Ğ´ĞµĞºÑÑ‹

**ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ğ¸Ğ½Ğ´ĞµĞºÑÑ‹:**
- `mkbs.code` (UNIQUE) - Ğ±Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº Ğ¿Ğ¾ ĞºĞ¾Ğ´Ñƒ ĞœĞšĞ‘
- `mkbs.title` - Ğ¿Ğ¾Ğ¸ÑĞº Ğ¿Ğ¾ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ
- `protocols.title` - Ğ¿Ğ¾Ğ¸ÑĞº Ğ¿Ğ¾ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¿Ñ€Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ»Ğ°
- `verified_advisory_sheets.status` - Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ ÑÑ‚Ğ°Ñ‚ÑƒÑÑƒ (red/yellow/green)
- `*.embedding` (pgvector) - Ğ²ĞµĞºÑ‚Ğ¾Ñ€Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº Ğ¿Ğ¾ cosine similarity

**Devise Ğ¸Ğ½Ğ´ĞµĞºÑÑ‹:** email, reset_password_token, confirmation_token (UNIQUE Ğ½Ğ° Ğ²ÑĞµÑ… user Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°Ñ…)

### 3.6 Ğ”Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° ER (ÑƒĞ¿Ñ€Ğ¾Ñ‰ĞµĞ½Ğ½Ğ°Ñ)

```
         AUTHENTICATION
         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”
      â”‚ Aud â”‚  â”‚ MD  â”‚  â”‚ Doc â”‚  (Devise users)
      â””â”€â”€â”¬â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”˜
         â”‚                 â”‚
         â”‚ has_many        â”‚ belongs_to
         â”‚                 â”‚
         â†“                 â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ NotVer â”‚        â”‚MainDoc â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ (verification job)
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Verifiedâ”‚  status: ğŸ”´/ğŸŸ¡/ğŸŸ¢
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜

         KNOWLEDGE BASE
         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”Œâ”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Mkb â”‚      â”‚ Protocol â”‚
    â””â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“              â†“
    [embedding]   [embedding]
       768d          768d
       â†“              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   pgvector search    â”‚
    â”‚ (cosine similarity)  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. API

### 4.1 ĞĞ±Ğ·Ğ¾Ñ€

**Ğ¢Ğ¸Ğ¿ API:** REST (Ñ‡Ğ°ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¾) + Rails MVC (HTML responses)
**ĞÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ:** Devise (session-based), Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğµ ÑĞºĞ¾Ğ¿Ñ‹ Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ Ñ€Ğ¾Ğ»Ğ¸
**Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ²:** HTML (Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹), JSON (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾ Ğ´Ğ»Ñ AJAX)

### 4.2 ĞŸÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚Ñ‹

| ĞœĞµÑ‚Ğ¾Ğ´ | ĞŸÑƒÑ‚ÑŒ | ĞšĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€#Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|-------|------|---------------------|----------|
| GET | `/` | home#index | Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° |
| GET | `/up` | rails/health#show | Health check endpoint |

### 4.3 ĞÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ (Devise)

#### Auditors (ĞÑƒĞ´Ğ¸Ñ‚Ğ¾Ñ€Ñ‹)

| ĞœĞµÑ‚Ğ¾Ğ´ | ĞŸÑƒÑ‚ÑŒ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|-------|------|----------|
| GET | `/cabinet/auditors/login` | Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ²Ñ…Ğ¾Ğ´Ğ° |
| POST | `/cabinet/auditors/login` | ĞÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ |
| DELETE | `/cabinet/auditors/logout` | Ğ’Ñ‹Ñ…Ğ¾Ğ´ |
| GET | `/cabinet/auditors/sign_up` | Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ (ĞµÑĞ»Ğ¸ Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ğ°) |
| POST | `/cabinet/auditors/password` | Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ |

#### Main Doctors (Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğµ Ğ²Ñ€Ğ°Ñ‡Ğ¸)

| ĞœĞµÑ‚Ğ¾Ğ´ | ĞŸÑƒÑ‚ÑŒ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|-------|------|----------|
| GET | `/cabinet/main_doctors/login` | Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ²Ñ…Ğ¾Ğ´Ğ° |
| POST | `/cabinet/main_doctors/login` | ĞÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ |
| DELETE | `/cabinet/main_doctors/logout` | Ğ’Ñ‹Ñ…Ğ¾Ğ´ |

#### Doctors (Ğ’Ñ€Ğ°Ñ‡Ğ¸)

| ĞœĞµÑ‚Ğ¾Ğ´ | ĞŸÑƒÑ‚ÑŒ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|-------|------|----------|
| GET | `/cabinet/doctors/login` | Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ²Ñ…Ğ¾Ğ´Ğ° |
| POST | `/cabinet/doctors/login` | ĞÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ |
| DELETE | `/cabinet/doctors/logout` | Ğ’Ñ‹Ñ…Ğ¾Ğ´ |

### 4.4 ĞÑƒĞ´Ğ¸Ñ‚Ğ¾Ñ€ (Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ)

| ĞœĞµÑ‚Ğ¾Ğ´ | ĞŸÑƒÑ‚ÑŒ | ĞšĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€#Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|-------|------|---------------------|----------|
| GET | `/cabinet/auditors/dashboard` | cabinet/auditors/dashboard#index | Ğ”Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´ Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ¾Ñ€Ğ° |
| GET | `/cabinet/auditors/advisory_sheets` | cabinet/auditors/advisory_sheets#index | Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº ĞšĞ› |
| GET | `/cabinet/auditors/advisory_sheets/upload` | cabinet/auditors/advisory_sheets#upload | Ğ¤Ğ¾Ñ€Ğ¼Ğ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² |
| POST | `/cabinet/auditors/advisory_sheets` | cabinet/auditors/advisory_sheets#create | Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° ĞšĞ› (multipart/form-data) |
| GET | `/cabinet/auditors/advisory_sheets/:id` | cabinet/auditors/advisory_sheets#show | ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ ĞšĞ› |

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²:**

```http
POST /cabinet/auditors/advisory_sheets
Content-Type: multipart/form-data

files[]: <file1.pdf>
files[]: <file2.docx>
```

**ĞÑ‚Ğ²ĞµÑ‚:** Redirect Ğ½Ğ° `/cabinet/auditors/advisory_sheets` Ñ flash ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸ĞµĞ¼.

### 4.5 Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ Ğ²Ñ€Ğ°Ñ‡ / Ğ’Ñ€Ğ°Ñ‡ (Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ)

| ĞœĞµÑ‚Ğ¾Ğ´ | ĞŸÑƒÑ‚ÑŒ | ĞšĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€#Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|-------|------|---------------------|----------|
| GET | `/cabinet/main_doctors/dashboard` | cabinet/main_doctors/dashboard#index | Ğ”Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´ Ğ³Ğ»Ğ°Ğ²Ğ²Ñ€Ğ°Ñ‡Ğ° |
| GET | `/cabinet/doctors/dashboard` | cabinet/doctors/dashboard#index | Ğ”Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´ Ğ²Ñ€Ğ°Ñ‡Ğ° |

### 4.6 Ğ’Ğ½ĞµÑˆĞ½Ğ¸Ğ¹ API (Gemini)

**Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ Ñ Google Gemini API:**

```ruby
# Ğ­Ğ½Ğ´Ğ¿Ğ¾Ğ¸Ğ½Ñ‚: generativelanguage.googleapis.com
# Ğ‘Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ°: RubyLLM gem (Ğ¾Ğ±ĞµÑ€Ñ‚ĞºĞ°)

# 1. Embeddings
POST https://generativelanguage.googleapis.com/v1beta/models/text-embedding-004:embedContent
Authorization: Bearer <GEMINI_API_KEY>
Content-Type: application/json

{
  "content": { "parts": [{ "text": "Ñ‚ĞµĞºÑÑ‚ Ğ´Ğ»Ñ embedding" }] }
}

Response: { "embedding": { "values": [0.1, 0.2, ..., 768 floats] } }

# 2. Chat (Verification)
POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-001:generateContent
Authorization: Bearer <GEMINI_API_KEY>
Content-Type: application/json

{
  "contents": [{ "role": "user", "parts": [{ "text": "prompt" }] }],
  "generationConfig": { "temperature": 0.1 }
}

Response: { "candidates": [{ "content": { "parts": [{ "text": "JSON response" }] } }] }
```

**Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ²:**
- `GeminiService.generate_embedding` - ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ²ĞµĞºÑ‚Ğ¾Ñ€Ğ¾Ğ²
- `GeminiService.verify_advisory_sheet` - AI Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· ĞšĞ›

### 4.7 ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº

**Rails ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ğµ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¸:**
- 404 Not Found - ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°
- 500 Internal Server Error - Ğ¾ÑˆĞ¸Ğ±ĞºĞ° ÑĞµÑ€Ğ²ĞµÑ€Ğ°
- 401 Unauthorized - Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ (Ñ€ĞµĞ´Ğ¸Ñ€ĞµĞºÑ‚ Ğ½Ğ° Ğ»Ğ¾Ğ³Ğ¸Ğ½)
- 403 Forbidden - Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğ·Ğ°Ğ¿Ñ€ĞµÑ‰ĞµĞ½

**Gemini API Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸:**
```ruby
# Ğ’ GeminiService Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½ fallback:
rescue StandardError => e
  Rails.logger.error("GeminiService error: #{e.message}")
  { status: :yellow, result: "ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸", recommendations: "" }
end
```

**Sidekiq Jobs:**
- ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ retry 3 Ñ€Ğ°Ğ·Ğ° Ñ polynomial backoff
- Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº Ğ² `log/sidekiq.log`

### 4.8 ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³

**Development:**
- Sidekiq Web UI: http://localhost:3000/sidekiq
- Logs: `tail -f log/development.log`

**Production:**
- Mission Control Jobs (Ğ½Ğ°ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾)
- Rails logs via `kamal app logs`

---

## 5. Ğ˜Ğ½Ñ„Ñ€Ğ°ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°

### 5.1 Ğ¥Ğ¾ÑÑ‚Ğ¸Ğ½Ğ³ Ğ¸ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ğµ

**Development (Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾):**
- Rails server: `localhost:3000`
- PostgreSQL: localhost:5432
- Redis: localhost:6379
- Sidekiq: Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ Ğ² Ñ„Ğ¾Ğ½Ğµ

**Production:**
- **ĞŸĞ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ°:** Ğ¡Ğ¾Ğ±ÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ ÑĞµÑ€Ğ²ĞµÑ€ / VPS
- **ĞšĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ:** Docker (ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ‡ĞµÑ€ĞµĞ· Kamal)
- **Ğ’ĞµĞ±-ÑĞµÑ€Ğ²ĞµÑ€:** Thruster (HTTP/2 reverse proxy, Rails 8 default)
- **App server:** Puma (Ğ²ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ² Rails)
- **Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…:** PostgreSQL 17 (Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğ¹ ÑĞµÑ€Ğ²ĞµÑ€, Ğ½Ğµ Ğ² ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğµ)
- **ĞšÑÑˆ/ĞÑ‡ĞµÑ€ĞµĞ´Ğ¸:** Redis (Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğ¹ ÑĞµÑ€Ğ²ĞµÑ€)
- **SSL:** Let's Encrypt (Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ñ‡ĞµÑ€ĞµĞ· Kamal)

**Ğ¢Ğ°Ñ€Ğ¸Ñ„Ğ½Ñ‹Ğ¹ Ğ¿Ğ»Ğ°Ğ½:** ĞĞµ ÑƒĞºĞ°Ğ·Ğ°Ğ½ (Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ñ‚ Ğ¾Ñ‚ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ° VPS)

### 5.2 ĞŸÑ€Ğ¾Ñ†ĞµÑÑ Ğ´ĞµĞ¿Ğ»Ğ¾Ñ

**Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚:** Kamal (Docker-based deployment)
**Ğ¢Ğ¸Ğ¿:** ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ñ‡ĞµÑ€ĞµĞ· CLI ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹

#### ĞŸĞµÑ€Ğ²Ğ¾Ğ½Ğ°Ñ‡Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°

```bash
# 1. Ğ—Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ config/deploy.yml
# Ğ£ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ IP ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ², registry, domain

# 2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ÑĞµĞºÑ€ĞµÑ‚Ñ‹ Ğ² .kamal/secrets
# RAILS_MASTER_KEY=...
# KAMAL_REGISTRY_PASSWORD=...
# DATABASE_PASSWORD=...

# 3. Setup ÑĞµÑ€Ğ²ĞµÑ€Ğ° (ÑƒÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµÑ‚ Docker, ÑĞ¾Ğ·Ğ´Ğ°ĞµÑ‚ volume)
kamal setup
```

#### Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ğ¹ Ğ´ĞµĞ¿Ğ»Ğ¾Ğ¹

```bash
# ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ´ĞµĞ¿Ğ»Ğ¾Ğ¹ (build + push + deploy)
kamal deploy

# ĞŸĞ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ:
# 1. Docker build Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ°
# 2. Push Ğ² registry (Docker Hub / custom)
# 3. Pull Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ° Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ğ°Ñ…
# 4. ĞÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° ÑÑ‚Ğ°Ñ€Ñ‹Ñ… ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ¾Ğ²
# 5. Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ½Ğ¾Ğ²Ñ‹Ñ… ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ¾Ğ²
# 6. Health check (GET /up)
# 7. ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ñ‚Ñ€Ğ°Ñ„Ğ¸ĞºĞ° Ğ½Ğ° Ğ½Ğ¾Ğ²ÑƒÑ Ğ²ĞµÑ€ÑĞ¸Ñ
```

#### ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¸ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ

```bash
# ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ»Ğ¾Ğ³Ğ¾Ğ²
kamal app logs -f

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑ‚Ğ°Ñ‚ÑƒÑĞ°
kamal app details

# Rails console Ğ½Ğ° Ğ¿Ñ€Ğ¾Ğ´Ğ°ĞºÑˆĞµĞ½Ğµ
kamal app exec -i "bin/rails console"

# Database console
kamal app exec -i "bin/rails dbconsole"

# ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞº
kamal app restart

# ĞÑ‚ĞºĞ°Ñ‚ Ğº Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞ¹ Ğ²ĞµÑ€ÑĞ¸Ğ¸
kamal rollback
```

**Ğ§Ğ°ÑÑ‚Ğ¾Ñ‚Ğ° Ğ´ĞµĞ¿Ğ»Ğ¾Ñ:** ĞŸĞ¾ Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ (Ñ€ÑƒÑ‡Ğ½Ğ¾Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº `kamal deploy`)

### 5.3 ĞŸĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ (Production)

**Ğ¡ĞµĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğµ (Ğ² .kamal/secrets):**
```bash
RAILS_MASTER_KEY=<64-char-hex>      # Ğ”Ğ»Ñ credentials.yml.enc
GEMINI_API_KEY=<api-key>            # Google Gemini API
DATABASE_PASSWORD=<password>        # PostgreSQL Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ
KAMAL_REGISTRY_PASSWORD=<token>     # Docker registry
```

**ĞŸÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğµ (Ğ² config/deploy.yml â†’ env.clear):**
```yaml
SOLID_QUEUE_IN_PUMA: true           # Ğ—Ğ°Ğ¿ÑƒÑĞº Solid Queue Ğ² Puma Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞµ
DB_HOST: 192.168.**.***               # ĞĞ´Ñ€ĞµÑ PostgreSQL ÑĞµÑ€Ğ²ĞµÑ€Ğ°
REDIS_URL: redis://192.168.***:**** # ĞĞ´Ñ€ĞµÑ Redis
RAILS_LOG_LEVEL: info               # Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
```

### 5.4 Ğ ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ¾Ğµ ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

#### Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… PostgreSQL

**ĞœĞµÑ‚Ğ¾Ğ´:** pg_dump (Ñ€ÑƒÑ‡Ğ½Ğ¾Ğ¹ Ğ¸Ğ»Ğ¸ Ñ‡ĞµÑ€ĞµĞ· cron)

```bash
# Ğ•Ğ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ñ‹Ğ¹ Ğ±ÑĞºĞ°Ğ¿ (Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ² cron Ğ½Ğ° DB ÑĞµÑ€Ğ²ĞµÑ€Ğµ)
0 2 * * * pg_dump -U postgres -d medical_audit_production \
  -F c -f /backups/medical_audit_$(date +\%Y\%m\%d).dump

# Ğ‘ÑĞºĞ°Ğ¿ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑÑ…ĞµĞ¼Ñ‹
pg_dump -U postgres -d medical_audit_production --schema-only \
  > schema_backup.sql

# Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸Ğ· Ğ±ÑĞºĞ°Ğ¿Ğ°
pg_restore -U postgres -d medical_audit_production \
  /backups/medical_audit_20250101.dump
```

**Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµĞ¼Ğ°Ñ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ:**
- Ğ•Ğ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ñ‹Ğµ Ğ±ÑĞºĞ°Ğ¿Ñ‹ Ğ² 2:00 AM (local time)
- Ğ¥Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ñ… 7 Ğ´Ğ½ĞµĞ¹ (Ğ½ĞµĞ´ĞµĞ»ÑŒĞ½Ğ°Ñ Ñ€Ğ¾Ñ‚Ğ°Ñ†Ğ¸Ñ)
- ĞœĞµÑÑÑ‡Ğ½Ñ‹Ğµ Ğ±ÑĞºĞ°Ğ¿Ñ‹ (Ğ¿ĞµÑ€Ğ²Ğ¾Ğµ Ñ‡Ğ¸ÑĞ»Ğ¾ Ğ¼ĞµÑÑÑ†Ğ°) - Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ 12 Ğ¼ĞµÑÑÑ†ĞµĞ²
- ĞšĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ‹Ñ… Ğ±ÑĞºĞ°Ğ¿Ğ¾Ğ² Ğ½Ğ° ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ½Ğ¾Ğµ Ñ…Ñ€Ğ°Ğ½Ğ¸Ğ»Ğ¸Ñ‰Ğµ (S3/BackBlaze)

#### Ğ¤Ğ°Ğ¹Ğ»Ñ‹ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ

**Docker volumes (Ñ‡ĞµÑ€ĞµĞ· Kamal):**
```yaml
# config/deploy.yml
volumes:
  - "medical_audit_storage:/rails/storage"  # ActiveStorage Ñ„Ğ°Ğ¹Ğ»Ñ‹
```

**Ğ‘ÑĞºĞ°Ğ¿ volume:**
```bash
# ĞĞ° ÑĞµÑ€Ğ²ĞµÑ€Ğµ
docker run --rm \
  -v medical_audit_storage:/source \
  -v /backups:/backup \
  alpine tar czf /backup/storage_$(date +%Y%m%d).tar.gz -C /source .

# Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ
docker run --rm \
  -v medical_audit_storage:/target \
  -v /backups:/backup \
  alpine tar xzf /backup/storage_20250101.tar.gz -C /target
```

#### ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ±ÑĞºĞ°Ğ¿Ğ¾Ğ²

**ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° cron Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ğµ Ğ‘Ğ”:**
```bash
# /etc/cron.d/medical_audit_backups
0 2 * * * postgres /scripts/backup_medical_audit.sh
0 3 1 * * postgres /scripts/monthly_backup.sh
```

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ğ° `backup_medical_audit.sh`:**
```bash
#!/bin/bash
BACKUP_DIR="/backups/daily"
DATE=$(date +%Y%m%d)
KEEP_DAYS=7

# Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ±ÑĞºĞ°Ğ¿
pg_dump -U postgres -d medical_audit_production \
  -F c -f $BACKUP_DIR/db_$DATE.dump

# Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ€Ñ‹Ğµ Ğ±ÑĞºĞ°Ğ¿Ñ‹ (>7 Ğ´Ğ½ĞµĞ¹)
find $BACKUP_DIR -name "db_*.dump" -mtime +$KEEP_DAYS -delete

# Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ½Ğ° S3 (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)
# aws s3 cp $BACKUP_DIR/db_$DATE.dump s3://bucket/backups/
```

**Ğ§Ñ‚Ğ¾ Ğ±ÑĞºĞ°Ğ¿Ğ¸Ñ‚ÑŒ:**
1. âœ… **PostgreSQL Ğ±Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…** (ĞµĞ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ğ¾)
2. âœ… **Docker volume** `/rails/storage` (ĞµÑĞ»Ğ¸ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ ActiveStorage)
3. âœ… **ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ Ñ„Ğ°Ğ¹Ğ»Ñ‹** `config/`, `.kamal/secrets` (Ğ¿Ñ€Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸ÑÑ…)
4. âšª **ĞšĞ¾Ğ´ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ** (Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑÑ Ğ² Git, Ğ½Ğµ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¾)
5. âšª **Gem'Ñ‹** (Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ÑÑ‚ÑÑ Ñ‡ĞµÑ€ĞµĞ· `bundle install`)

### 5.5 ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¸ Ğ°Ğ»ĞµÑ€Ñ‚Ñ‹

**Ğ’ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ñ‹Ğµ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹:**
- Health check endpoint: `GET /up` (Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ÑÑ Kamal Ğ¿Ğ¾ÑĞ»Ğµ Ğ´ĞµĞ¿Ğ»Ğ¾Ñ)
- Sidekiq monitoring: Mission Control Jobs (Ğ½Ğ°ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾)
- Bullet (N+1 queries) - Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ development

### 5.6 ĞœĞ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

**Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ:** Single server (Ğ¼Ğ¾Ğ½Ğ¾Ğ»Ğ¸Ñ‚)

**Ğ“Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ½Ñ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ (Ğ¿Ñ€Ğ¸ Ñ€Ğ¾ÑÑ‚Ğµ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸):**
```yaml
# config/deploy.yml
servers:
  web:
    - 192.168.0.1
    - 192.168.0.2  # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ²Ñ‚Ğ¾Ñ€Ğ¾Ğ¹ Ğ²ĞµĞ±-ÑĞµÑ€Ğ²ĞµÑ€
    - 192.168.0.3  # Ğ¢Ñ€ĞµÑ‚Ğ¸Ğ¹ ÑĞµÑ€Ğ²ĞµÑ€
  job:
    hosts:
      - 192.168.0.4  # ĞÑ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ ÑĞµÑ€Ğ²ĞµÑ€ Ğ´Ğ»Ñ Sidekiq jobs
    cmd: bin/jobs
```

**Load balancer:** ĞĞ°ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾ (Nginx, HAProxy, CloudFlare)

---

## 6. Ğ¡Ñ‚Ğ¾Ñ€Ğ¾Ğ½Ğ½Ğ¸Ğµ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ¸ Ğ¸ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹

### 6.1 Backend Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ (Ruby gems)

| Gem | Ğ’ĞµÑ€ÑĞ¸Ñ | ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ | Ğ›Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ñ | Ğ¡Ñ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ |
|-----|--------|-----------|----------|-----------|
| **rails** | 8.0.4 | Web framework | MIT | âœ… Ğ‘ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾ |
| **pg** | ~1.5 | PostgreSQL adapter | BSD | âœ… Ğ‘ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾ |
| **puma** | ~7.1 | Web server | BSD | âœ… Ğ‘ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾ |
| **devise** | ~4.9 | Authentication | MIT | âœ… Ğ‘ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾ |
| **devise-i18n** | ~1.12 | Devise Ğ»Ğ¾ĞºĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ | MIT | âœ… Ğ‘ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾ |

#### AI & RAG

| Gem | Ğ’ĞµÑ€ÑĞ¸Ñ | ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ | Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ |
|-----|--------|-----------|--------------|
| **ruby_llm** | 1.9.1 | Unified AI interface | [Docs](https://github.com/ruby-llm/ruby_llm) |
| **neighbor** | latest | pgvector integration | [Docs](https://github.com/ankane/neighbor) |
| **tiktoken_ruby** | latest | Token counting | [Docs](https://github.com/IAPark/tiktoken_ruby) |

#### File Processing

| Gem | Ğ’ĞµÑ€ÑĞ¸Ñ | Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ñ‹ | Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ |
|-----|--------|---------|--------------|
| **pdf-reader** | latest | PDF | [Docs](https://github.com/yob/pdf-reader) |
| **docx** | latest | DOCX | [Docs](https://github.com/ruby-docx/docx) |
| **roo** | ~3.0.0 | XLS/XLSX/CSV | [Docs](https://github.com/roo-rb/roo) |
| **ruby-vips** | latest | Image processing | [Docs](https://github.com/libvips/ruby-vips) |

#### Background Jobs & Scheduling

| Gem | Ğ’ĞµÑ€ÑĞ¸Ñ | ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ | Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ |
|-----|--------|-----------|--------------|
| **sidekiq** | ~8.0 | Background jobs | [Docs](https://github.com/sidekiq/sidekiq) |
| **redis** | ~5.4 | Sidekiq backend | [Docs](https://github.com/redis/redis-rb) |
| **solid_queue** | latest | ActiveJob backend (Rails 8) | [Docs](https://github.com/rails/solid_queue) |
| **solid_cache** | latest | DB-backed cache (Rails 8) | [Docs](https://github.com/rails/solid_cache) |
| **solid_cable** | latest | WebSocket (Rails 8) | [Docs](https://github.com/rails/solid_cable) |
| **whenever** | ~1.1 | Cron job DSL | [Docs](https://github.com/javan/whenever) |
| **mission_control-jobs** | latest | Job monitoring UI | [Docs](https://github.com/basecamp/mission_control-jobs) |

#### Frontend & Assets

| Gem | Ğ’ĞµÑ€ÑĞ¸Ñ | ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ | Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ |
|-----|--------|-----------|--------------|
| **tailwindcss-rails** | ~4.0 | Tailwind CSS integration | [Docs](https://github.com/rails/tailwindcss-rails) |
| **propshaft** | latest | Asset pipeline (Rails 8) | [Docs](https://github.com/rails/propshaft) |
| **importmap-rails** | latest | ES Modules Ğ±ĞµĞ· ÑĞ±Ğ¾Ñ€ĞºĞ¸ | [Docs](https://github.com/rails/importmap-rails) |
| **turbo-rails** | latest | Hotwire Turbo | [Docs](https://turbo.hotwired.dev/) |
| **stimulus-rails** | latest | Hotwire Stimulus | [Docs](https://stimulus.hotwired.dev/) |

#### Development & Testing

| Gem | Ğ’ĞµÑ€ÑĞ¸Ñ | ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ | Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Dev/Test |
|-----|--------|-----------|-----------------|
| **rspec-rails** | ~8.0.0 | Testing framework | âœ… |
| **factory_bot_rails** | ~6.5 | Test data factories | âœ… |
| **faker** | latest | Fake data generator | âœ… |
| **capybara** | ~3.40 | Integration testing | âœ… |
| **selenium-webdriver** | ~4.39 | Browser automation | âœ… |
| **database_cleaner-active_record** | ~2.2 | Test DB cleanup | âœ… |
| **shoulda-matchers** | ~7.0 | RSpec matchers | âœ… |
| **rubocop-rails-omakase** | latest | Linter (Rails style) | âœ… |
| **brakeman** | latest | Security scanner | âœ… |
| **annotate** | latest | Schema comments | âœ… dev |
| **bullet** | latest | N+1 queries detection | âœ… dev |
| **letter_opener** | ~1.10 | Email preview | âœ… dev |
| **web-console** | latest | In-browser console | âœ… dev |
| **debug** | latest | Debugger | âœ… |
| **dotenv-rails** | latest | .env file loader | âœ… |

#### Deployment

| Gem | Ğ’ĞµÑ€ÑĞ¸Ñ | ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ | Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ |
|-----|--------|-----------|--------------|
| **kamal** | latest | Docker deployment | [Docs](https://kamal-deploy.org/) |
| **thruster** | latest | HTTP/2 proxy | [Docs](https://github.com/basecamp/thruster) |

### 6.2 Ğ’Ğ½ĞµÑˆĞ½Ğ¸Ğµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹

| Ğ¡ĞµÑ€Ğ²Ğ¸Ñ | ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ | Ğ¢Ğ°Ñ€Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ | API Key |
|--------|-----------|-------------|---------|
| **Google Gemini API** | AI embeddings + chat | Pay-per-use | âœ… Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ |
| **PostgreSQL 17** | ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ğ‘Ğ” | Ğ¡Ğ°Ğ¼Ğ¾Ñ…Ğ¾ÑÑ‚Ğ¸Ğ½Ğ³ / VPS | - |
| **Redis** | Sidekiq queue + cache | Ğ¡Ğ°Ğ¼Ğ¾Ñ…Ğ¾ÑÑ‚Ğ¸Ğ½Ğ³ / VPS | - |
| **Docker Registry** | Ğ¥Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ² | Docker Hub (free tier) | âœ… Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ |
| **Let's Encrypt** | SSL ÑĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ñ‹ | âœ… Ğ‘ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾ | ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ |

### 6.3 ĞŸĞ»Ğ°Ñ‚Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸

> âœ… **Ğ’ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğµ ĞĞ•Ğ¢ Ğ¿Ğ»Ğ°Ñ‚Ğ½Ñ‹Ñ… Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹.**

**ĞŸĞ¾Ñ‚ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ñ€Ğ°ÑÑ…Ğ¾Ğ´Ñ‹ (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾):**
- Google Gemini API - pay-per-use (Ğ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾ Ğ¿Ñ€Ğ¸ Ğ¿Ñ€ĞµĞ²Ñ‹ÑˆĞµĞ½Ğ¸Ğ¸ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ¾Ğ²)
  - Ğ‘ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ñ‹Ğ¹ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚: 15 requests/min, 1500 requests/day
  - Ğ¦ĞµĞ½Ñ‹: [ai.google.dev/pricing](https://ai.google.dev/pricing)
- VPS Ñ…Ğ¾ÑÑ‚Ğ¸Ğ½Ğ³ (Ğ¾Ñ‚ 14 000 Ñ‚Ğ³/Ğ¼ĞµÑ, Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ñ‚ Ğ¾Ñ‚ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ°)
- ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ (Sentry, New Relic - Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)

### 6.4 JavaScript Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ (Ñ‡ĞµÑ€ĞµĞ· importmap)

```json
// config/importmap.rb ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚:
{
  "@hotwired/turbo-rails": "turbo.js",
  "@hotwired/stimulus": "stimulus.js",
  "@hotwired/stimulus-loading": "stimulus-loading.js"
}
```

**Node.js Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ:**
- Tailwind CSS ĞºĞ¾Ğ¼Ğ¿Ğ¸Ğ»ÑÑ†Ğ¸Ñ (`rails tailwindcss:build`)
- Ğ’ÑĞµ Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ñ‡ĞµÑ€ĞµĞ· importmap (Ğ±ĞµĞ· npm/webpack/vite)

---

### ĞŸĞ»Ğ°Ğ½Ğ¸Ñ€ÑƒĞµĞ¼Ñ‹Ğµ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ñ
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ JSON API endpoints Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ
- [ ] ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Mission Control Jobs
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ğ¾Ñ‚Ñ‡ĞµÑ‚Ğ¾Ğ² Ğ² PDF
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ Ğ¸ Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´Ñ‹ Ğ´Ğ»Ñ Ğ³Ğ»Ğ°Ğ²Ğ²Ñ€Ğ°Ñ‡Ğ°
- [ ] ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ error tracking (Sentry)


**Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ:**
- ĞšĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¸ Ğ² ĞºĞ¾Ğ´Ğµ (RuboCop enforces documentation)

**ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ:** 2025-12-11
**Ğ’ĞµÑ€ÑĞ¸Ñ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ğ¸:** 1.0.0
